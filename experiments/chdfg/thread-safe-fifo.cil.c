/* Generated by CIL v. 1.7.3 */
/* print_CIL_Input is true */

#line 213 "/usr/lib/gcc/x86_64-linux-gnu/4.7/include/stddef.h"
typedef unsigned long size_t;
#line 140 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __off_t;
#line 141 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __off64_t;
#line 44 "/usr/include/stdio.h"
struct _IO_FILE;
#line 48 "/usr/include/stdio.h"
typedef struct _IO_FILE FILE;
#line 155 "/usr/include/libio.h"
typedef void _IO_lock_t;
#line 161 "/usr/include/libio.h"
struct _IO_marker {
   struct _IO_marker *_next ;
   struct _IO_FILE *_sbuf ;
   int _pos ;
};
#line 246 "/usr/include/libio.h"
struct _IO_FILE {
   int _flags ;
   char *_IO_read_ptr ;
   char *_IO_read_end ;
   char *_IO_read_base ;
   char *_IO_write_base ;
   char *_IO_write_ptr ;
   char *_IO_write_end ;
   char *_IO_buf_base ;
   char *_IO_buf_end ;
   char *_IO_save_base ;
   char *_IO_backup_base ;
   char *_IO_save_end ;
   struct _IO_marker *_markers ;
   struct _IO_FILE *_chain ;
   int _fileno ;
   int _flags2 ;
   __off_t _old_offset ;
   unsigned short _cur_column ;
   signed char _vtable_offset ;
   char _shortbuf[1] ;
   _IO_lock_t *_lock ;
   __off64_t _offset ;
   void *__pad1 ;
   void *__pad2 ;
   void *__pad3 ;
   void *__pad4 ;
   size_t __pad5 ;
   int _mode ;
   char _unused2[(15UL * sizeof(int ) - 4UL * sizeof(void *)) - sizeof(size_t )] ;
};
#line 75 "/usr/include/x86_64-linux-gnu/bits/pthreadtypes.h"
struct __pthread_internal_list {
   struct __pthread_internal_list *__prev ;
   struct __pthread_internal_list *__next ;
};
#line 75 "/usr/include/x86_64-linux-gnu/bits/pthreadtypes.h"
typedef struct __pthread_internal_list __pthread_list_t;
#line 90 "/usr/include/x86_64-linux-gnu/bits/pthreadtypes.h"
struct __pthread_mutex_s {
   int __lock ;
   unsigned int __count ;
   int __owner ;
   unsigned int __nusers ;
   int __kind ;
   int __spins ;
   __pthread_list_t __list ;
};
#line 90 "/usr/include/x86_64-linux-gnu/bits/pthreadtypes.h"
union __anonunion_pthread_mutex_t_7 {
   struct __pthread_mutex_s __data ;
   char __size[40] ;
   long __align ;
};
#line 90 "/usr/include/x86_64-linux-gnu/bits/pthreadtypes.h"
typedef union __anonunion_pthread_mutex_t_7 pthread_mutex_t;
#line 9 "queue_ts.h"
struct _node {
   void *data ;
   struct _node *next ;
};
#line 13 "queue_ts.h"
typedef struct _node node;
#line 15 "queue_ts.h"
struct _end_q {
   node *first ;
   node *last ;
};
#line 19 "queue_ts.h"
typedef struct _end_q queue;
#line 148 "/usr/include/x86_64-linux-gnu/bits/types.h"
typedef long __time_t;
#line 75 "/usr/include/time.h"
typedef __time_t time_t;
#line 60 "/usr/include/x86_64-linux-gnu/bits/pthreadtypes.h"
typedef unsigned long pthread_t;
#line 63 "/usr/include/x86_64-linux-gnu/bits/pthreadtypes.h"
union pthread_attr_t {
   char __size[56] ;
   long __align ;
};
#line 69 "/usr/include/x86_64-linux-gnu/bits/pthreadtypes.h"
typedef union pthread_attr_t pthread_attr_t;
#line 19 "fifo_test.c"
struct _stru {
   int number ;
   int thread_no ;
   queue *q ;
};
#line 1 "fifo.o"
#pragma merger("0","/tmp/cil-Ub9rMHsE.i","-Wall,-Wstrict-prototypes,-Werror,-g")
#line 170 "/usr/include/stdio.h"
extern struct _IO_FILE *stderr ;
#line 356
extern int fprintf(FILE * __restrict  __stream , char const   * __restrict  __format 
                   , ...) ;
#line 753 "/usr/include/pthread.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__nonnull__(1))) pthread_mutex_lock)(pthread_mutex_t *__mutex ) ;
#line 764
extern  __attribute__((__nothrow__)) int ( __attribute__((__nonnull__(1))) pthread_mutex_unlock)(pthread_mutex_t *__mutex ) ;
#line 465 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__)) void *( __attribute__((__leaf__)) malloc)(size_t __size )  __attribute__((__malloc__)) ;
#line 482
extern  __attribute__((__nothrow__)) void ( __attribute__((__leaf__)) free)(void *__ptr ) ;
#line 23 "queue_ts.h"
queue *queue_factory(void) ;
#line 26
void queue_destroy(queue *que ) ;
#line 31
int enque(queue *que , void *data ) ;
#line 36
void *deque(queue *que ) ;
#line 32 "fifo.c"
pthread_mutex_t mutex  =    {{0, 0U, 0, 0U, 0, 0, {(struct __pthread_internal_list *)0, (struct __pthread_internal_list *)0}}};
#line 37 "fifo.c"
queue *queue_factory(void) 
{ 
  queue *new_queue ;
  void *tmp ;

  {
#line 39
  tmp = malloc(sizeof(queue ));
#line 39
  new_queue = (queue *)tmp;
#line 40
  if ((unsigned long )new_queue == (unsigned long )((void *)0)) {
#line 41
    fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"Malloc failed creating the que\n");
#line 42
    return ((queue *)((void *)0));
  }
#line 44
  new_queue->first = (node *)((void *)0);
#line 45
  new_queue->last = (node *)((void *)0);
#line 49
  return (new_queue);
}
}
#line 52 "fifo.c"
void queue_destroy(queue *que ) 
{ 
  node *_node ;
  node *tmp ;

  {
#line 57
  if ((unsigned long )que == (unsigned long )((void *)0)) {
#line 58
    return;
  }
#line 63
  pthread_mutex_lock(& mutex);
#line 64
  if ((unsigned long )que->first == (unsigned long )((void *)0)) {
#line 66
    free((void *)que);
#line 67
    pthread_mutex_unlock(& mutex);
#line 68
    return;
  }
#line 73
  _node = que->first;
#line 75
  while ((unsigned long )_node != (unsigned long )((void *)0)) {
#line 79
    free(_node->data);
#line 80
    tmp = _node->next;
#line 81
    free((void *)_node);
#line 82
    _node = tmp;
  }
#line 85
  free((void *)que);
#line 87
  pthread_mutex_unlock(& mutex);
#line 88
  return;
}
}
#line 94 "fifo.c"
int enque(queue *que , void *data ) 
{ 
  node *new_node ;
  void *tmp ;

  {
#line 96
  tmp = malloc(sizeof(node ));
#line 96
  new_node = (node *)tmp;
#line 97
  if ((unsigned long )new_node == (unsigned long )((void *)0)) {
#line 98
    fprintf((FILE * __restrict  )stderr, (char const   * __restrict  )"Malloc failed creating a node\n");
#line 99
    return (-1);
  }
#line 102
  new_node->data = data;
#line 103
  new_node->next = (struct _node *)((void *)0);
#line 105
  pthread_mutex_lock(& mutex);
#line 106
  if ((unsigned long )que->first == (unsigned long )((void *)0)) {
#line 108
    que->first = new_node;
#line 109
    que->last = new_node;
  } else {
#line 111
    (que->last)->next = new_node;
#line 112
    que->last = new_node;
  }
#line 114
  pthread_mutex_unlock(& mutex);
#line 116
  return (0);
}
}
#line 119 "fifo.c"
void *deque(queue *que ) 
{ 
  void *data ;
  node *_node ;

  {
#line 122
  if ((unsigned long )que == (unsigned long )((void *)0)) {
#line 124
    return ((void *)0);
  }
#line 128
  pthread_mutex_lock(& mutex);
#line 129
  if ((unsigned long )que->first == (unsigned long )((void *)0)) {
#line 130
    pthread_mutex_unlock(& mutex);
#line 132
    return ((void *)0);
  }
#line 136
  _node = que->first;
#line 137
  if ((unsigned long )que->first == (unsigned long )que->last) {
#line 138
    que->first = (node *)((void *)0);
#line 139
    que->last = (node *)((void *)0);
  } else {
#line 141
    que->first = _node->next;
  }
#line 144
  data = _node->data;
#line 147
  free((void *)_node);
#line 148
  pthread_mutex_unlock(& mutex);
#line 150
  return (data);
}
}
#line 1 "fifo_test.o"
#pragma merger("0","/tmp/cil-nlY2RDlj.i","-Wall,-Wstrict-prototypes,-Werror,-g")
#line 362 "/usr/include/stdio.h"
extern int printf(char const   * __restrict  __format  , ...) ;
#line 386
extern  __attribute__((__nothrow__)) int ( /* format attribute */  snprintf)(char * __restrict  __s ,
                                                                             size_t __maxlen ,
                                                                             char const   * __restrict  __format 
                                                                             , ...) ;
#line 192 "/usr/include/time.h"
extern  __attribute__((__nothrow__)) time_t ( __attribute__((__leaf__)) time)(time_t *__timer ) ;
#line 232 "/usr/include/pthread.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__nonnull__(1,3))) pthread_create)(pthread_t * __restrict  __newthread ,
                                                                                             pthread_attr_t const   * __restrict  __attr ,
                                                                                             void *(*__start_routine)(void * ) ,
                                                                                             void * __restrict  __arg ) ;
#line 249
extern int pthread_join(pthread_t __th , void **__thread_return ) ;
#line 374 "/usr/include/stdlib.h"
extern  __attribute__((__nothrow__)) int ( __attribute__((__leaf__)) rand)(void) ;
#line 376
extern  __attribute__((__nothrow__)) void ( __attribute__((__leaf__)) srand)(unsigned int __seed ) ;
#line 25 "fifo_test.c"
void *func(void *arg ) 
{ 
  struct _stru *args ;
  int number ;
  queue *q ;
  int i ;
  time_t tmp ;
  char *message ;
  void *tmp___0 ;
  int tmp___1 ;

  {
#line 27
  args = (struct _stru *)arg;
#line 28
  number = args->number;
#line 30
  q = args->q;
#line 33
  tmp = time((time_t *)((void *)0));
#line 33
  srand((unsigned int )tmp);
#line 34
  i = 0;
#line 34
  while (i < number) {
#line 35
    tmp___0 = malloc((size_t )16);
#line 35
    message = (char *)tmp___0;
#line 36
    tmp___1 = rand();
#line 36
    snprintf((char * __restrict  )message, (size_t )15, (char const   * __restrict  )"rand: %d",
             tmp___1);
#line 37
    enque(q, (void *)message);
#line 34
    i ++;
  }
#line 40
  return ((void *)0);
}
}
#line 44 "fifo_test.c"
void *func_d(void *args ) 
{ 
  queue *q ;
  void *data ;
  char *string ;

  {
#line 46
  printf((char const   * __restrict  )"Func_D running....\n");
#line 48
  q = (queue *)args;
#line 51
  while (1) {
#line 51
    data = deque(q);
#line 51
    if (! ((unsigned long )data != (unsigned long )((void *)0))) {
#line 51
      break;
    }
#line 52
    string = (char *)data;
#line 53
    printf((char const   * __restrict  )"DeQued : %s, @%p\n", string, data);
#line 54
    free(data);
  }
#line 56
  printf((char const   * __restrict  )"Func_D exiting....\n");
#line 58
  return ((void *)0);
}
}
#line 61 "fifo_test.c"
int main(void) 
{ 
  queue *q ;
  queue *tmp ;
  pthread_t threads[6] ;
  pthread_t thread_d[5] ;
  int i ;
  struct _stru arg[6] ;

  {
#line 63
  tmp = queue_factory();
#line 63
  q = tmp;
#line 70
  i = 0;
#line 70
  while (i < 6) {
#line 71
    arg[i].number = 1000;
#line 72
    arg[i].thread_no = i;
#line 73
    arg[i].q = q;
#line 74
    pthread_create((pthread_t * __restrict  )(threads + i), (pthread_attr_t const   * __restrict  )((void *)0),
                   & func, (void * __restrict  )((void *)(& arg[i])));
#line 70
    i ++;
  }
#line 77
  i = 0;
#line 77
  while (i < 5) {
#line 78
    pthread_create((pthread_t * __restrict  )(thread_d + i), (pthread_attr_t const   * __restrict  )((void *)0),
                   & func_d, (void * __restrict  )((void *)q));
#line 77
    i ++;
  }
#line 81
  i = 0;
#line 81
  while (i < 6) {
#line 82
    pthread_join(*(threads + i), (void **)((void *)0));
#line 81
    i ++;
  }
#line 85
  i = 0;
#line 85
  while (i < 5) {
#line 86
    pthread_join(*(thread_d + i), (void **)((void *)0));
#line 85
    i ++;
  }
#line 89
  printf((char const   * __restrict  )"Going to run queue_destroy(...) \n");
#line 90
  queue_destroy(q);
#line 91
  printf((char const   * __restrict  )"que freeed... :) \n");
#line 93
  return (0);
}
}
